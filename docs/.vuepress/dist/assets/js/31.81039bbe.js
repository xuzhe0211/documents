(window.webpackJsonp=window.webpackJsonp||[]).push([[31],{381:function(a,t,e){"use strict";e.r(t);var r=e(42),v=Object(r.a)({},(function(){var a=this,t=a.$createElement,e=a._self._c||t;return e("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[e("h2",{attrs:{id:"原理"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#原理"}},[a._v("#")]),a._v(" 原理")]),a._v(" "),e("blockquote",[e("p",[a._v("Android中的JSBridge是H5与Native通信桥梁,其作用是实现H5与Native间的双向通信。")])]),a._v(" "),e("p",[a._v("现H5与Native的双向通信，解决如下四个问题接口")]),a._v(" "),e("ul",[e("li",[a._v("Java如何调用JavaScript")]),a._v(" "),e("li",[a._v("JavaScrip如何调用Java")]),a._v(" "),e("li",[a._v("方法参数以及回调如何处理")]),a._v(" "),e("li",[a._v("通信的数据格式是怎么样的")])]),a._v(" "),e("h4",{attrs:{id:"_1-java如何调用javascript"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-java如何调用javascript"}},[a._v("#")]),a._v(" 1.Java如何调用JavaScript")]),a._v(" "),e("p",[a._v("在Android中，Java和JavaScript的一切交互都是依托于WebView的，可通过如下方法来完成，其中Function()即为Javascript代码，来实现相应的具体H5功能")]),a._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("WebView.loadUrl('Javascript:function()')\n")])])]),e("h4",{attrs:{id:"_2、javascript如何调用java"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2、javascript如何调用java"}},[a._v("#")]),a._v(" 2、JavaScript如何调用Java")]),a._v(" "),e("p",[a._v("要实现在JavaScript中调用Java，就需要在JavaScript中有触发Java方法的对象和方法。在JavaScript中，当调用window对象的prompt方法时，会触发Java中的WebChromeClient对象的onJsPrompt方法，因此可以利用这个机制来实现js调用native的代码")]),a._v(" "),e("h4",{attrs:{id:"_3、方法参数以及回调处理"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3、方法参数以及回调处理"}},[a._v("#")]),a._v(" 3、方法参数以及回调处理")]),a._v(" "),e("p",[a._v("任何IPC通信都涉及到参数序列化的问题，同理，Java与JavaScript之间只能传递基础类型（包括基本类型和字符串），不包括其他对象或者函数。所以可以采用json格式来传递数据。JavaScript与Java相互调用不能直接获取返回值，只能通过回调的方式来获取返回结果。")]),a._v(" "),e("h4",{attrs:{id:"_4、通信的数据格式"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_4、通信的数据格式"}},[a._v("#")]),a._v(" 4、通信的数据格式")]),a._v(" "),e("p",[a._v("Java与JavaScript通信需要遵循一定的通信协议，可以仿照HTTPS协议来将此协议定义为jsbridge协议：")]),a._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("jsbridge://className:port/methodName?jsonObj\n")])])]),e("p",[a._v("当js调用native功能，应当制定native层要完成某个功能调用的类名(className)和方法名(methodName)，以及传递过来的参数(jsonObj)。port值是指当native需要将操作结果返回给js时，在js中定义的一个callback,并将这个callback存储在指定的位置上，这个port就定义了callback的存储位置。\n"),e("img",{attrs:{src:"http://upload-images.jianshu.io/upload_images/2327406-7349581b80fc1df1.png",alt:"图片"}})]),a._v(" "),e("h4",{attrs:{id:"总结"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#总结"}},[a._v("#")]),a._v(" 总结")]),a._v(" "),e("p",[a._v("JSBridge的基本原理为\nH5 -> 通过某种方式触发一个url -> Native捕获到url,进行分析 -> 原生做处理 -> Native调用H5的JSBridge对象传递回调。"),e("br"),a._v("\n如下图")]),a._v(" "),e("p",[e("img",{attrs:{src:"/images/2327406-a45afb11e62699dc.webp",alt:"原理图"}})]),a._v(" "),e("p",[a._v("参考地址："),e("a",{attrs:{href:"https://www.jianshu.com/p/2ec3f06d6087?from=singlemessage",target:"_blank",rel:"noopener noreferrer"}},[a._v("https://www.jianshu.com/p/2ec3f06d6087?from=singlemessage"),e("OutboundLink")],1)]),a._v(" "),e("h2",{attrs:{id:"webview"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#webview"}},[a._v("#")]),a._v(" WebView")]),a._v(" "),e("p",[a._v("WebView是一种嵌入式浏览器，原生应用可以用它来展示网络内容"),e("br"),a._v("\n第一：原生应用(app)"),e("br"),a._v("\n第二：嵌入式浏览器"),e("br")]),a._v(" "),e("p",[a._v("开发人员可以使用各种受支持的方式来覆盖默认的安全行为，并让Web代码和原生应用代码相互通信。这种沟通通常称为bridge。Bridge可视化为Native Bridge和JavaScript Bridge的一部分；详细了解这些bridge内容超出本文范围，但要点如下：为Web编写的相同Javascript不仅可以在WebView中运行，还可以调用原生API并帮助苏你应用更升入得集成炫酷的系统级功能，如传感器，存储和，日历/联系人等；")])])}),[],!1,null,null,null);t.default=v.exports}}]);